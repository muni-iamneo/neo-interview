<div>
  <h3>Agent</h3>
  
  @if (!hasValidSession()) {
    <div style="padding: 20px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 4px; margin-bottom: 20px;">
      <h4>‚ö†Ô∏è No Active Session</h4>
      <p>Please start from the <a href="/moderator">Moderator page</a> first.</p>
      <p>The moderator will create a session and open this page automatically.</p>
    </div>
  }
  
  @if (hasValidSession()) {
    <!-- Session Status Banner -->
    @if (sessionInfo()) {
      <div style="padding: 12px; margin-bottom: 12px; border-radius: 4px; background: #f8f9fa;" [style.border-left]="'4px solid ' + getStatusBorderColor()">
        <div style="display: flex; justify-content: space-between; align-items: center;">
          <div>
            <strong style="display: block; margin-bottom: 4px;">
              @if (interviewStatus() === 'active') {
                ‚úÖ Interview Active
              } @else if (interviewStatus() === 'dropped') {
                ‚ö†Ô∏è Connection Dropped
              } @else if (interviewStatus() === 'paused') {
                ‚è∏Ô∏è Interview Paused
              } @else if (interviewStatus() === 'ended') {
                üèÅ Interview Ended
              } @else {
                üìã Session Info
              }
            </strong>
            @if (sessionInfo()!.meetingId) {
              <span style="font-size: 0.9em; color: #6c757d;">Meeting: {{ sessionInfo()!.meetingId }}</span>
            }
            @if (sessionInfo()!.maxInterviewMinutes && sessionInfo()!.interviewStartTime) {
              <span style="font-size: 0.9em; color: #6c757d; margin-left: 10px;">
                Duration: {{ sessionInfo()!.maxInterviewMinutes }} min
              </span>
            }
          </div>
          @if (canRejoin() && (interviewStatus() === 'dropped' || interviewStatus() === 'paused')) {
            <button (click)="attemptRejoin()" style="padding: 6px 12px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 0.9em;">
              üîÑ Rejoin Session
            </button>
          }
        </div>
        @if (sessionInfo()!.endReason) {
          <div style="margin-top: 8px; font-size: 0.85em; color: #6c757d;">
            Reason: {{ sessionInfo()!.endReason }}
          </div>
        }
      </div>
    }
    
    <div id="jaas-iframe" style="height: 60vh; margin-bottom:12px; border:1px solid #eee;"></div>
    <!-- Mic controls removed: meeting audio only -->
    <div>
      <strong>Agent Responses</strong>
      <pre>{{ agentResponses() }}</pre>
    </div>
    <div style="margin: 10px 0;">
      <button (click)="enableAudio()" style="margin-right: 10px; padding: 8px 16px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer;">
        üéß Enable Audio
      </button>
      <button (click)="toggleMicStreaming()" style="margin-right: 10px;">
        {{ isMicStreaming() ? 'Stop Microphone' : 'Start Microphone' }}
      </button>
      <button (click)="requestEndInterview()" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
        üèÅ End Interview
      </button>
    </div>
    
    @if (showEndConfirm()) {
      <div style="position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 20px; border: 2px solid #dc3545; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); z-index: 1000; max-width: 400px;">
        <h3 style="margin-top: 0; color: #dc3545;">Confirm End Interview</h3>
        <p>Are you sure you want to end the interview? This will close the session and disconnect from Jitsi.</p>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
          <button (click)="cancelEndInterview()" style="padding: 8px 16px; background: #6c757d; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Cancel
          </button>
          <button (click)="confirmEndInterview()" style="padding: 8px 16px; background: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer;">
            Yes, End Interview
          </button>
        </div>
      </div>
      <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 999;" (click)="cancelEndInterview()"></div>
    }
  }
  <hr>
</div>
